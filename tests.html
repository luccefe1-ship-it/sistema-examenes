
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tests - Plataforma Ex√°menes</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/tests.css">
    <style>
        /* FONDOS DIN√ÅMICOS SINCRONIZADOS CON HOMEPAGE */
        body {
            transition: background 1s ease;
            /* FONDO CELESTE CLARO POR DEFECTO PARA EL D√çA */
            background: 
                radial-gradient(ellipse at top, rgba(135,206,250,0.3) 0%, rgba(173,216,230,0.4) 50%, rgba(176,196,222,0.5) 100%),
                radial-gradient(circle at 20% 80%, rgba(200,230,255,0.15) 0%, transparent 60%),
                radial-gradient(circle at 80% 20%, rgba(200,230,255,0.15) 0%, transparent 60%),
                radial-gradient(circle at 40% 40%, rgba(220,240,255,0.12) 0%, transparent 60%),
                radial-gradient(circle at 60% 70%, rgba(220,240,255,0.14) 0%, transparent 60%),
                radial-gradient(circle at 10% 10%, rgba(200,230,255,0.12) 0%, transparent 60%),
                radial-gradient(circle at 90% 90%, rgba(200,230,255,0.10) 0%, transparent 60%),
                radial-gradient(circle at 30% 20%, rgba(173,216,230,0.06) 0%, transparent 50%),
                radial-gradient(circle at 70% 80%, rgba(176,196,222,0.06) 0%, transparent 50%);
        }

        /* FONDO D√çA (6:00 - 18:00) - Celeste muy clarito */
        body.dia {
            background: 
                radial-gradient(ellipse at top, rgba(135,206,250,0.3) 0%, rgba(173,216,230,0.4) 50%, rgba(176,196,222,0.5) 100%),
                radial-gradient(circle at 20% 80%, rgba(200,230,255,0.15) 0%, transparent 60%),
                radial-gradient(circle at 80% 20%, rgba(200,230,255,0.15) 0%, transparent 60%),
                radial-gradient(circle at 40% 40%, rgba(220,240,255,0.12) 0%, transparent 60%),
                radial-gradient(circle at 60% 70%, rgba(220,240,255,0.14) 0%, transparent 60%),
                radial-gradient(circle at 10% 10%, rgba(200,230,255,0.12) 0%, transparent 60%),
                radial-gradient(circle at 90% 90%, rgba(200,230,255,0.10) 0%, transparent 60%),
                radial-gradient(circle at 30% 20%, rgba(173,216,230,0.06) 0%, transparent 50%),
                radial-gradient(circle at 70% 80%, rgba(176,196,222,0.06) 0%, transparent 50%);
        }

        /* FONDO TARDE (18:00 - 21:00) - Gradiente naranja abajo izquierda a azul oscuro arriba derecha */
        body.tarde {
            background: 
                linear-gradient(45deg, rgba(255,120,40,0.6) 0%, rgba(255,140,60,0.5) 20%, rgba(120,150,200,0.4) 60%, rgba(40,60,120,0.8) 100%),
                radial-gradient(circle at 20% 80%, rgba(255,200,150,0.10) 0%, transparent 60%),
                radial-gradient(circle at 80% 20%, rgba(100,120,180,0.08) 0%, transparent 60%),
                radial-gradient(circle at 40% 40%, rgba(255,150,100,0.06) 0%, transparent 60%),
                radial-gradient(circle at 60% 70%, rgba(80,100,160,0.07) 0%, transparent 60%),
                radial-gradient(circle at 10% 10%, rgba(255,140,90,0.08) 0%, transparent 60%),
                radial-gradient(circle at 90% 90%, rgba(60,80,140,0.06) 0%, transparent 60%),
                radial-gradient(circle at 30% 20%, rgba(220,140,80,0.04) 0%, transparent 50%),
                radial-gradient(circle at 70% 80%, rgba(80,100,160,0.04) 0%, transparent 50%);
        }

        /* FONDO NOCHE (21:00 - 6:00) - Muy oscuro */
        body.noche {
            background: 
                radial-gradient(ellipse at top, rgba(25,25,60,0.8) 0%, rgba(30,30,70,0.9) 50%, rgba(15,15,40,0.95) 100%),
                radial-gradient(circle at 20% 80%, rgba(100,100,150,0.06) 0%, transparent 60%),
                radial-gradient(circle at 80% 20%, rgba(100,100,150,0.06) 0%, transparent 60%),
                radial-gradient(circle at 40% 40%, rgba(100,100,150,0.04) 0%, transparent 60%),
                radial-gradient(circle at 60% 70%, rgba(100,100,150,0.05) 0%, transparent 60%),
                radial-gradient(circle at 10% 10%, rgba(100,100,150,0.04) 0%, transparent 60%),
                radial-gradient(circle at 90% 90%, rgba(100,100,150,0.03) 0%, transparent 60%),
                radial-gradient(circle at 30% 20%, rgba(50,50,100,0.02) 0%, transparent 50%),
                radial-gradient(circle at 70% 80%, rgba(60,60,120,0.02) 0%, transparent 50%);
        }

        /* Estilos para el dropdown de temas */
        .dropdown-temas {
            position: relative;
            width: 100%;
        }

        .dropdown-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        .dropdown-header:hover {
            border-color: #007bff;
        }

        .dropdown-placeholder {
            color: #666;
            font-size: 14px;
        }

        .dropdown-arrow {
            color: #666;
            font-size: 12px;
            transition: transform 0.3s;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 8px 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 1000;
            max-height: 300px;
            overflow-y: auto;
        }

        .tema-opcion-dropdown {
            padding: 12px 16px;
            border-bottom: 1px solid #eee;
        }

        .tema-opcion-dropdown.especial {
            background: #f8f9fa;
            font-weight: bold;
        }

        .tema-dropdown-item {
            border-bottom: 1px solid #eee;
        }

        .tema-principal-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
        }

        .tema-checkbox-container {
            flex: 1;
        }

        .tema-label, .subtema-label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            width: 100%;
        }

        .tema-nombre, .subtema-nombre {
            flex: 1;
            font-weight: 500;
        }

        .tema-preguntas, .subtema-preguntas {
            font-size: 12px;
            color: #666;
            background: #e9ecef;
            padding: 2px 8px;
            border-radius: 12px;
        }

        .subtemas-toggle {
            padding: 4px 8px;
            cursor: pointer;
            user-select: none;
        }

        .subtema-arrow {
            color: #666;
            font-size: 12px;
            transition: transform 0.3s;
        }

        .subtemas-container {
            background: #f8f9fa;
        }

        .subtema-row {
            padding: 8px 16px 8px 32px;
            border-top: 1px solid #eee;
        }

        .subtema-nombre {
            color: #666;
            font-weight: normal !important;
        }

        .tema-checkbox {
            margin-right: 8px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .dropdown-content {
                max-height: 250px;
            }
            
            .tema-principal-row {
                padding: 10px 12px;
            }
            
            .subtema-row {
                padding: 6px 12px 6px 24px;
            }
        }

        /* ==========================================
           SOLUCI√ìN SCROLL CORREGIDA
           ========================================== */

        /* SOLUCI√ìN GLOBAL DE SCROLL */
        html, body {
            height: 100%;
            overflow-x: hidden;
            overflow-y: auto !important;
            scroll-behavior: smooth;
        }

        /* Asegurar que el contenedor principal tenga scroll */
        .container {
            min-height: calc(100vh - 120px);
            overflow-y: auto;
            padding-bottom: 2rem;
        }

        /* Ajustar navbar para scroll */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .sub-navbar {
            position: fixed;
            top: 60px;
            left: 0;
            right: 0;
            z-index: 999;
            background: white;
            border-bottom: 1px solid #ddd;
        }

        /* Ajustar el contenido para que no se esconda detr√°s de headers */
        .main-content {
            margin-top: 120px;
            min-height: calc(100vh - 120px);
            overflow: visible;
        }

        /* Secciones de contenido SIN scroll interno - solo usar scroll general */
        .content-section {
            min-height: calc(100vh - 140px);
            overflow: visible;
            padding: 20px 0;
        }

        /* Asegurar que las √°reas grandes tengan scroll SOLO cuando sea necesario */
        .test-config-container {
            overflow: visible;
            padding: 20px;
        }

        .test-ejecutando {
            overflow: visible;
            padding: 20px 0;
        }

       .resultados-container {
    overflow: visible;
    padding: 20px 0;
    margin-top: -120px !important;
}

        /* Lista de temas SIN scroll interno - usar solo el scroll general */
        .temas-list {
            overflow: visible;
            padding: 10px 0;
        }

        /* Lista de resultados SIN scroll interno */
        .resultados-list {
            overflow: visible;
            padding: 10px 0;
        }

        /* Preguntas del test SIN scroll interno */
        .preguntas-test-container {
    overflow: visible;
    padding: 50px 100px; /* Mucho m√°s padding horizontal */
}

        /* √Årea de texto que puede ser grande */
        .upload-area textarea {
            max-height: 400px;
            resize: vertical;
        }

        .preguntas-preview {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        /* Modales que podr√≠an necesitar scroll */
        .modal-content {
            max-height: 90vh;
            overflow-y: auto;
        }

        /* Scrollbar personalizada para mejor apariencia */
        *::-webkit-scrollbar {
            width: 8px;
        }

        *::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        *::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        *::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }

        /* Responsive - M√≥vil - SIN scroll interno */
        @media (max-width: 768px) {
            .main-content {
                margin-top: 100px;
            }
            
            .content-section {
                min-height: calc(100vh - 120px);
                padding: 15px 0;
                overflow: visible;
            }
            
           .test-config-container,
.resultados-container {
    padding: 15px;
}

.test-ejecutando {
    padding: 0; /* Eliminar padding que limita el ancho */
    max-width: none; /* Permitir ancho completo */
}
        }

        /* Asegurar que elementos espec√≠ficos no interfieran con scroll */
        .tema-controls,
        .config-form,
        .test-header {
            position: relative;
            z-index: 1;
        }

        /* Evitar overflow horizontal en elementos espec√≠ficos */
        .opciones-cantidad,
        .opciones-tiempo {
            overflow-x: hidden;
        }

        /* Dropdown debe estar por encima de todo y expandirse libremente */
        .dropdown-temas .dropdown-content {
            position: absolute !important;
            overflow-y: auto !important;
            overflow-x: hidden !important;
            max-height: 300px !important;
        }

        /* Mejorar visualizaci√≥n en pantallas peque√±as */
        .tema-opcion-dropdown {
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
    </style>
</head>
<body>
    <!-- Header principal (no tocar) -->
    <nav class="navbar">
        <div class="nav-content">
            <h1>Plataforma Ex√°menes de Justicia</h1>
            <div class="nav-actions">
                <span id="userName">Cargando...</span>
                <button id="backBtn">‚Üê Volver</button>
                <button id="logoutBtn">Cerrar Sesi√≥n</button>
            </div>
        </div>
    </nav>

    <!-- Sub-header para tests -->
    <nav class="sub-navbar">
        <div class="sub-nav-content">
            <button class="sub-nav-btn" data-section="subir">Subir Preguntas</button>
<button class="sub-nav-btn" data-section="banco">Banco de Preguntas</button>
<button class="sub-nav-btn active" data-section="aleatorio">Hacer Test Aleatorio</button>
<button class="sub-nav-btn" data-section="resultados">Resultados</button>
        </div>
    </nav>

    <!-- Contenido principal -->
    <div class="container">
        <div class="main-content">
            
            <!-- Secci√≥n: Subir Preguntas -->
            <div id="subir-section" class="content-section">
                
                
                <!-- Gesti√≥n de temas -->
                <div class="tema-controls">
                    <div class="tema-group">
                        <button id="crearTemaBtn" class="btn-secondary">Crear Tema</button>
                        <button id="seleccionarTemaBtn" class="btn-secondary">Seleccionar Tema</button>
                        <span id="temaSeleccionado" class="tema-actual">Tema: Ninguno seleccionado</span>
<button id="importarArchivoBtn" class="btn-primary">üìÅ Importar desde Archivo</button>
<input type="file" id="fileInput" accept=".json" style="display: none;">
                    </div>
                </div>

                <!-- √Årea de texto para pegar preguntas -->
                <div class="upload-area">
                    <label for="textoPreguntas">Pega aqu√≠ el texto de DeepSeek:</label>
                    <textarea id="textoPreguntas" placeholder="Pega aqu√≠ el texto formateado por DeepSeek...

Ejemplo:
01 . El Pr√≠ncipe Heredero tendr√° la dignidad de Pr√≠ncipe de Asturias:
A) Desde que se le atribuyan por el Rey.
B)**Desde su nacimiento o desde que se produzca el hecho que origine el llamamiento.
C) Desde que se le reconozcan por las Cortes Generales.
D) Desde que alcance la mayor√≠a de edad."></textarea>
                    <button id="procesarTextoBtn" class="btn-primary">Procesar Texto</button>
                </div>

                <!-- Vista previa de preguntas procesadas -->
                <div id="preguntasProcesadas" class="preguntas-preview" style="display: none;">
                    <h3>Preguntas Procesadas</h3>
                    <div id="listaPreguntasPreview"></div>
                    <button id="asignarPreguntasBtn" class="btn-success" disabled>Asignar Preguntas al Tema</button>
                </div>
            </div>

            <!-- Secci√≥n: Banco de Preguntas -->
<div id="banco-section" class="content-section">
    <!-- Bot√≥n crear tema para banco -->
    <div class="banco-header">
        <button id="crearTemaBancoBtn" class="btn-secondary">üìÅ Crear Tema</button>
    </div>
    <div id="listaTemas" class="temas-list">
        <!-- Aqu√≠ se cargar√°n los temas din√°micamente -->
    </div>
</div>

            <!-- Secci√≥n: Hacer Test Aleatorio -->

            <!-- Secci√≥n: Hacer Test Aleatorio -->
<div id="aleatorio-section" class="content-section active">
    <div class="test-config-container">
        
        
        <div class="config-form">
            <!-- Modo de test -->
            <div class="config-group">
                <label>üéØ Modo de Test:</label>
                <div class="mode-selector">
                    <button class="mode-btn active" data-mode="completo">
                        <span class="mode-icon">üìã</span>
                        <span class="mode-title">Test Completo</span>
                        <span class="mode-desc">Todas las preguntas juntas</span>
                    </button>
                    <button class="mode-btn" data-mode="pregunta">
                        <span class="mode-icon">üéØ</span>
                        <span class="mode-title">Pregunta a Pregunta</span>
                        <span class="mode-desc">Una por una con correcci√≥n instant√°nea</span>
                    </button>
                </div>
            </div>

            <!-- Selecci√≥n de tema -->
            <div class="config-group">
                <label>üìö Seleccionar Temas:</label>
                <div class="dropdown-temas">
                    <div class="dropdown-header" onclick="toggleDropdownTemas()">
                        <span class="dropdown-placeholder">Elige temas para tu test</span>
                        <span class="dropdown-arrow">‚ñº</span>
                    </div>
                    <div class="dropdown-content" id="dropdownTemasContent">
                        <div class="tema-opcion-dropdown especial">
    <label style="display: flex; justify-content: space-between; align-items: center; width: 100%; gap: 12px;">
        <div style="display: flex; align-items: center; gap: 8px; flex: 0 1 auto; white-space: nowrap;">
            <input type="checkbox" id="todosLosTemas" value="todos" checked onclick="debugClick(this)" onchange="manejarSeleccionTema(event)">
            <span class="tema-nombre">Todos los temas (Test General)</span>
        </div>
        <span class="tema-preguntas" id="preguntasTodosTemas" style="flex-shrink: 0;">0 preguntas</span>
    </label>
</div>
                        <div id="listaTemasDropdown" class="lista-temas-dropdown">
                            <!-- Los temas se cargar√°n aqu√≠ din√°micamente -->
                        </div>
                    </div>
                </div>
                <span id="preguntasDisponibles" class="preguntas-info">0 preguntas verificadas disponibles</span>
            </div>

            <!-- N√∫mero de preguntas -->
            <div class="config-group">
                <label for="numPreguntas">üìä N√∫mero de preguntas:</label>
                <div class="opciones-cantidad">
                    <button type="button" class="btn-cantidad active" data-cantidad="15">15</button>
                    <button type="button" class="btn-cantidad" data-cantidad="25">25</button>
                    <button type="button" class="btn-cantidad" data-cantidad="50">50</button>
                    <button type="button" class="btn-cantidad" data-cantidad="100">100</button>
                    <button type="button" class="btn-cantidad" data-cantidad="todas">Todas</button>
                </div>
                <input type="hidden" id="preguntasSeleccionadas" value="15">
            </div>

            <!-- Duraci√≥n del examen -->
            <div class="config-group">
                <label for="duracionTest">‚è∞ Duraci√≥n del examen:</label>
                <div class="opciones-tiempo">
                    <button type="button" class="btn-tiempo" data-tiempo="5">5 min</button>
                    <button type="button" class="btn-tiempo" data-tiempo="10">10 min</button>
                    <button type="button" class="btn-tiempo" data-tiempo="15">15 min</button>
                    <button type="button" class="btn-tiempo" data-tiempo="60">1 hora</button>
                    <button type="button" class="btn-tiempo active" data-tiempo="sin">Sin tiempo</button>
                </div>
                <input type="hidden" id="tiempoSeleccionado" value="sin">
            </div>

            <!-- Nombre del test -->
            <div class="config-group">
                <label for="nombreTest">‚úèÔ∏è Nombre del test:</label>
                <input type="text" id="nombreTest" class="config-input" placeholder="Ej: Test Constituci√≥n Espa√±ola - Tema 1" maxlength="100">
            </div>

            <!-- Bot√≥n empezar -->
            <button id="empezarTestBtn" class="btn-empezar-test">
                üöÄ Empezar Test
            </button>
        </div>
    </div>

    <!-- Test de Repaso -->
    <div id="testRepasoContainer" class="test-repaso-container" style="display: none;">
        <div class="test-repaso-card">
            <div class="repaso-header">
                <span class="repaso-icono">üîÑ</span>
                <h3>Test de Repaso Disponible</h3>
            </div>
            <div class="repaso-info">
                <p>Tienes <span class="repaso-contador">0 preguntas</span> falladas esperando repaso.</p>
                <p class="repaso-descripcion">Repasa solo las preguntas que has fallado anteriormente</p>
            </div>
            <div class="repaso-acciones">
                <button class="btn-test-repaso" onclick="iniciarTestRepaso()">
                    üîÑ Test de Repaso (0 preguntas)
                </button>
                <button class="btn-limpiar-repaso" onclick="limpiarTodasPreguntasFalladas()">
                    üóëÔ∏è Limpiar Todo
                </button>
            </div>
        </div>
    </div>

    <!-- √Årea del test en ejecuci√≥n -->
    <div id="testEnEjecucion" class="test-ejecutando" style="display: none;">
        <!-- Header del test con cron√≥metro -->
        <div class="test-header">
            <div class="test-info">
                <h3 id="tituloTestActual">Test en curso</h3>
                <div class="progreso-test">
                    <span id="preguntaActualNum">1</span> / <span id="totalPreguntasTest">10</span>
                </div>
            </div>
            <div class="cronometro">
                <div id="tiempoRestante" class="tiempo-display">--:--</div>
                <div class="tiempo-label">Tiempo restante</div>
            </div>
        </div>

        <!-- Contenedor de preguntas -->
        <div id="preguntasTestContainer" class="preguntas-test-container">
            <!-- Las preguntas se generar√°n din√°micamente aqu√≠ -->
        </div>

        <!-- Bot√≥n finalizar -->
        <div class="test-footer">
            <button id="finalizarTestBtn" class="btn-finalizar-test">
                ‚úÖ Finalizar Test
            </button>
        </div>
    </div>

    <!-- Pantalla de resultados -->
    <div id="resultadosTest" class="resultados-container" style="display: none;">
        <!-- Los resultados se generar√°n din√°micamente aqu√≠ -->
    </div>
</div>

            <!-- Secci√≥n: Resultados -->
            <div id="resultados-section" class="content-section">
                
                <div id="listaResultados" class="resultados-list">
                    <!-- Aqu√≠ se cargar√°n los resultados -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modales -->
    <div id="modalCrearTema" class="modal">
    <div class="modal-content">
        <h3>Crear Nuevo Tema</h3>
        <input type="text" id="nombreTema" placeholder="Nombre del tema" maxlength="50">
        <textarea id="descripcionTema" placeholder="Descripci√≥n del tema (opcional)" maxlength="200"></textarea>
        <div class="subtema-option">
            <label>
                <input type="checkbox" id="esSubtema"> Es un subtema
            </label>
            <select id="temaPadreSelect" style="display: none; margin-top: 10px; width: 100%; padding: 8px;">
                <option value="">Selecciona tema padre...</option>
            </select>
        </div>
        <div class="modal-actions">
            <button id="confirmarCrearTema" class="btn-primary">Crear</button>
            <button id="cancelarCrearTema" class="btn-secondary">Cancelar</button>
        </div>
    </div>
</div>

    <div id="modalSeleccionarTema" class="modal">
        <div class="modal-content">
            <h3>Seleccionar Tema</h3>
            <select id="listaTemaSelect">
                <option value="">Selecciona un tema...</option>
            </select>
            <div class="modal-actions">
                <button id="confirmarSeleccionarTema" class="btn-primary">Seleccionar</button>
                <button id="cancelarSeleccionarTema" class="btn-secondary">Cancelar</button>
            </div>
        </div>
    </div>

    <script type="module" src="js/tests.js"></script>
    <script type="module" src="Progreso.js"></script>
    <script>
// Funci√≥n para actualizar el fondo seg√∫n la hora
function actualizarFondoHora() {
    const ahora = new Date();
    const hora = ahora.getHours();
    const body = document.body;
    
    // Limpiar clases anteriores
    body.classList.remove('dia', 'tarde', 'noche');
    
    if (hora >= 6 && hora < 18) {
        body.classList.add('dia');
    } else if (hora >= 18 && hora < 21) {
        body.classList.add('tarde');
    } else {
        body.classList.add('noche');
    }
}

// Aplicar fondo al cargar
document.addEventListener('DOMContentLoaded', () => {
    actualizarFondoHora();
});

// Actualizar cada hora
setInterval(actualizarFondoHora, 60000 * 60);
</script>
</body>
</html>
